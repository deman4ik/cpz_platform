require("source-map-support").install(),module.exports=function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s="./src/index.js")}({"./src/index.js":function(e,r,t){"use strict";t.r(r);t("babel-polyfill");var n=t("vorpal"),a=t.n(n),o=t("uuid"),c=t("verror"),i=t.n(c),u=t("azure-keyvault"),s=t.n(u),p=t("adal-node");var y=function(e,r){try{return new s.a.KeyVaultClient(new s.a.KeyVaultCredentials(function(t,n){return new p.AuthenticationContext(t.authorization).acquireTokenWithClientCredentials(t.resource,e,r,function(e,r){if(e)throw e;return n(null,"".concat(r.tokenType," ").concat(r.accessToken))})}))}catch(e){throw new i.a({name:"KeyVaultError",cause:e},"Failed to create KeyVault client")}};function l(e,r,t,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function f(){var e;return e=regeneratorRuntime.mark(function e(r){var t,n,a,o,c,u,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.uri,n=r.clientId,a=r.appSecret,o=r.keyName,e.prev=1,c=y(n,a),u={keySize:4096,keyOps:["encrypt","decrypt"]},e.next=7,c.createKey(t,o,"RSA",u);case 7:return p=e.sent,l=s.a.parseKeyIdentifier(p.key.kid),e.abrupt("return",l);case 12:throw e.prev=12,e.t0=e.catch(1),new i.a({name:"KeyVaultError",cause:e.t0},"Failed to create new key");case 15:case"end":return e.stop()}},e,this,[[1,12]])}),(f=function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function c(e){l(o,n,a,c,i,"next",e)}function i(e){l(o,n,a,c,i,"throw",e)}c(void 0)})}).apply(this,arguments)}var v=function(e){return f.apply(this,arguments)};function m(e,r,t,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function d(){var e;return e=regeneratorRuntime.mark(function e(r){var t,n,a,o,c,u,s,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.uri,n=r.clientId,a=r.appSecret,o=r.value,c=r.keyName,u=r.keyVersion,s=void 0===u?"":u,e.prev=1,p=y(n,a),e.next=5,p.encrypt(t,c,s,"RSA-OAEP",Buffer.from(o));case 5:return l=e.sent,e.abrupt("return",JSON.stringify(l.result));case 9:throw e.prev=9,e.t0=e.catch(1),new i.a({name:"KeyVaultError",cause:e.t0},"Failed to encrypt value");case 12:case"end":return e.stop()}},e,this,[[1,9]])}),(d=function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function c(e){m(o,n,a,c,i,"next",e)}function i(e){m(o,n,a,c,i,"throw",e)}c(void 0)})}).apply(this,arguments)}var P=function(e){return d.apply(this,arguments)};function I(e,r,t,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function h(){var e;return e=regeneratorRuntime.mark(function e(r){var t,n,a,o,c,u,p,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.uri,n=r.clientId,a=r.appSecret,o=r.secretValue,c=r.secretName,e.prev=1,u=y(n,a),e.next=5,u.setSecret(t,c,o);case 5:return p=e.sent,l=s.a.parseSecretIdentifier(p.id),e.abrupt("return",l);case 10:throw e.prev=10,e.t0=e.catch(1),new i.a({name:"KeyVaultError",cause:e.t0},"Failed to set secret");case 13:case"end":return e.stop()}},e,this,[[1,10]])}),(h=function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function c(e){I(o,n,a,c,i,"next",e)}function i(e){I(o,n,a,c,i,"throw",e)}c(void 0)})}).apply(this,arguments)}var S=function(e){return h.apply(this,arguments)},A=t("dotenv-safe");function K(e,r,t,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function w(e){return function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function c(e){K(o,n,a,c,i,"next",e)}function i(e){K(o,n,a,c,i,"throw",e)}c(void 0)})}}t.n(A).a.config();var x=process.env,N=x.KEY_VAULT_URL,b=x.KEY_VAULT_WRITE_CLIENT_ID,g=x.KEY_VAULT_WRITE_APP_SECRET;function k(e,r,t){return E.apply(this,arguments)}function E(){return(E=w(regeneratorRuntime.mark(function e(r,t,n){var a,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v({uri:N,clientId:b,appSecret:g,keyName:r});case 2:return e.next=4,P({uri:N,clientId:b,appSecret:g,value:n,keyName:r});case 4:return a=e.sent,e.next=7,S({uri:N,clientId:b,appSecret:g,secretValue:a,secretName:t});case 7:return o=e.sent,e.abrupt("return",o.version);case 9:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function R(){return(R=w(regeneratorRuntime.mark(function e(r){var t,n,a,c,i,u,s,p,y,l,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.log(r),t=r.APIKey,n=r.APISecret,a=r.options,c=a.user,i=a.spare,u=a.APIKeyEncrKeyName,s=a.APISecretEncrKeyName,p=a.APIKeySecretName,y=a.APISecretSecretName,l={APIKey:{},APISecret:{}},c&&(l.APIKey.encryptionKeyName=c.toString(),l.APISecret.encryptionKeyName=c.toString(),l.APIKey.name=c.toString(),l.APISecret.name=c.toString()),l.APIKey.encryptionKeyName=u||l.APIKey.encryptionKeyName||Object(o.v4)(),l.APISecret.encryptionKeyName=s||l.APISecret.encryptionKeyName||Object(o.v4)(),l.APIKey.name=p||l.APIKey.name||Object(o.v4)(),l.APISecret.name=y||l.APISecret.name||Object(o.v4)(),e.next=11,k(l.APIKey.encryptionKeyName,l.APIKey.name,t);case 11:return l.APIKey.version=e.sent,e.next=14,k(l.APISecret.encryptionKeyName,l.APISecret.name,n);case 14:l.APISecret.version=e.sent,f={},i?f.spare=l:f.main=l,this.log(JSON.stringify(f));case 18:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var _=new a.a;_.command("kv save api-keys <APIKey> <APISecret>","Encrypt and save Exchange API Keys to Key Vault.").option("-u, --user <userId>","Use userId as name").option("-s, --spare","Save spare keys.").option("--APIKeyEncrKeyName <APIKeyEncrKeyName>","Encryption key name for API Key.").option("--APISecretEncrKeyName <APISecretEncrKeyName>","Encryption key name for API Secret.").option("--APIKeySecretName <APIKeySecretName>","Name of secret for API Key.").option("--APISecretSecretName <APISecretSecretName>","Name of secret for API Secret.").action(function(e){return R.apply(this,arguments)}),_.delimiter("cpz$").show()},"adal-node":function(e,r){e.exports=require("adal-node")},"azure-keyvault":function(e,r){e.exports=require("azure-keyvault")},"babel-polyfill":function(e,r){e.exports=require("babel-polyfill")},"dotenv-safe":function(e,r){e.exports=require("dotenv-safe")},uuid:function(e,r){e.exports=require("uuid")},verror:function(e,r){e.exports=require("verror")},vorpal:function(e,r){e.exports=require("vorpal")}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4uL2Nwei1zaGFyZWQva2V5VmF1bHQvY2xpZW50LmpzIiwid2VicGFjazovLy8uLi9jcHotc2hhcmVkL2tleVZhdWx0L2NyZWF0ZUtleS5qcyIsIndlYnBhY2s6Ly8vLi4vY3B6LXNoYXJlZC9rZXlWYXVsdC9lbmNyeXB0LmpzIiwid2VicGFjazovLy8uLi9jcHotc2hhcmVkL2tleVZhdWx0L3NldFNlY3JldC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMva2V5VmF1bHQvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy9leHRlcm5hbCBcImFkYWwtbm9kZVwiIiwid2VicGFjazovLy9leHRlcm5hbCBcImF6dXJlLWtleXZhdWx0XCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiYmFiZWwtcG9seWZpbGxcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJkb3RlbnYtc2FmZVwiIiwid2VicGFjazovLy9leHRlcm5hbCBcInV1aWRcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJ2ZXJyb3JcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJ2b3JwYWxcIiJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImdldENsaWVudCIsImNsaWVudElkIiwic2VjcmV0IiwiS2V5VmF1bHQiLCJLZXlWYXVsdENsaWVudCIsIktleVZhdWx0Q3JlZGVudGlhbHMiLCJjaGFsbGVuZ2UiLCJjYWxsYmFjayIsIkF1dGhlbnRpY2F0aW9uQ29udGV4dCIsImF1dGhvcml6YXRpb24iLCJhY3F1aXJlVG9rZW5XaXRoQ2xpZW50Q3JlZGVudGlhbHMiLCJyZXNvdXJjZSIsImVyciIsInRva2VuUmVzcG9uc2UiLCJjb25jYXQiLCJ0b2tlblR5cGUiLCJhY2Nlc3NUb2tlbiIsImVycm9yIiwiVkVycm9yIiwiY2F1c2UiLCJfY2FsbGVlIiwiX3JlZiIsInVyaSIsImFwcFNlY3JldCIsImtleU5hbWUiLCJrZXlWYXVsdENsaWVudCIsImtleU9wdGlvbnMiLCJyZXN1bHQiLCJrZXlJZCIsInJlZ2VuZXJhdG9yUnVudGltZSIsIndyYXAiLCJfY29udGV4dCIsInByZXYiLCJuZXh0Iiwia2V5U2l6ZSIsImtleU9wcyIsImNyZWF0ZUtleSIsInNlbnQiLCJwYXJzZUtleUlkZW50aWZpZXIiLCJraWQiLCJhYnJ1cHQiLCJ0MCIsInN0b3AiLCJ0aGlzIiwiX3JlZiRrZXlWZXJzaW9uIiwia2V5VmVyc2lvbiIsImVuY3J5cHQiLCJCdWZmZXIiLCJmcm9tIiwiSlNPTiIsInN0cmluZ2lmeSIsInNlY3JldFZhbHVlIiwic2VjcmV0TmFtZSIsInNlY3JldElkIiwic2V0U2VjcmV0IiwicGFyc2VTZWNyZXRJZGVudGlmaWVyIiwiaWQiLCJkb3RlbnYiLCJjb25maWciLCJwcm9jZXNzIiwiZW52IiwiS0VZX1ZBVUxUX1VSTCIsIktFWV9WQVVMVF9XUklURV9DTElFTlRfSUQiLCJLRVlfVkFVTFRfV1JJVEVfQVBQX1NFQ1JFVCIsImVuY3J5cHRBbmRTYXZlIiwiZW5jcnlwdGVkRGF0YSIsInZlcnNpb24iLCJfY2FsbGVlMiIsImFyZ3MiLCJBUElLZXkiLCJBUElTZWNyZXQiLCJfYXJncyRvcHRpb25zIiwidXNlciIsInNwYXJlIiwiQVBJS2V5RW5jcktleU5hbWUiLCJBUElTZWNyZXRFbmNyS2V5TmFtZSIsIkFQSUtleVNlY3JldE5hbWUiLCJBUElTZWNyZXRTZWNyZXROYW1lIiwiaW5mbyIsImtleXMiLCJfY29udGV4dDIiLCJsb2ciLCJvcHRpb25zIiwiZW5jcnlwdGlvbktleU5hbWUiLCJ0b1N0cmluZyIsInV1aWQiLCJtYWluIiwidm9ycGFsIiwiVm9ycGFsIiwiY29tbWFuZCIsIm9wdGlvbiIsImFjdGlvbiIsImRlbGltaXRlciIsInNob3ciLCJyZXF1aXJlIl0sIm1hcHBpbmdzIjoibUVBQ0EsSUFBQUEsRUFBQSxHQUdBLFNBQUFDLEVBQUFDLEdBR0EsR0FBQUYsRUFBQUUsR0FDQSxPQUFBRixFQUFBRSxHQUFBQyxRQUdBLElBQUFDLEVBQUFKLEVBQUFFLEdBQUEsQ0FDQUcsRUFBQUgsRUFDQUksR0FBQSxFQUNBSCxRQUFBLElBVUEsT0FOQUksRUFBQUwsR0FBQU0sS0FBQUosRUFBQUQsUUFBQUMsSUFBQUQsUUFBQUYsR0FHQUcsRUFBQUUsR0FBQSxFQUdBRixFQUFBRCxRQTBEQSxPQXJEQUYsRUFBQVEsRUFBQUYsRUFHQU4sRUFBQVMsRUFBQVYsRUFHQUMsRUFBQVUsRUFBQSxTQUFBUixFQUFBUyxFQUFBQyxHQUNBWixFQUFBYSxFQUFBWCxFQUFBUyxJQUNBRyxPQUFBQyxlQUFBYixFQUFBUyxFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDWixFQUFBa0IsRUFBQSxTQUFBaEIsR0FDQSxvQkFBQWlCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFiLEVBQUFpQixPQUFBQyxZQUFBLENBQXdEQyxNQUFBLFdBRXhEUCxPQUFBQyxlQUFBYixFQUFBLGNBQWlEbUIsT0FBQSxLQVFqRHJCLEVBQUFzQixFQUFBLFNBQUFELEVBQUFFLEdBRUEsR0FEQSxFQUFBQSxJQUFBRixFQUFBckIsRUFBQXFCLElBQ0EsRUFBQUUsRUFBQSxPQUFBRixFQUNBLEtBQUFFLEdBQUEsaUJBQUFGLFFBQUFHLFdBQUEsT0FBQUgsRUFDQSxJQUFBSSxFQUFBWCxPQUFBWSxPQUFB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UUFBQSxtQ0NBQS9ILEVBQUFELFFBQUFnSSxRQUFBLDhCQ0FBL0gsRUFBQUQsUUFBQWdJLFFBQUEsZ0NDQUEvSCxFQUFBRCxRQUFBZ0ksUUFBQSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSBcIi4vc3JjL2luZGV4LmpzXCIpO1xuIiwiaW1wb3J0IFZFcnJvciBmcm9tIFwidmVycm9yXCI7XG5pbXBvcnQgS2V5VmF1bHQgZnJvbSBcImF6dXJlLWtleXZhdWx0XCI7XG5pbXBvcnQgeyBBdXRoZW50aWNhdGlvbkNvbnRleHQgfSBmcm9tIFwiYWRhbC1ub2RlXCI7XG5cbi8qKlxuICog0JrQu9C40LXQvdGCINC6INGB0LvRg9C20LHQtSBBenVyZSBLZXlWYXVsdFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCDQuNC00LXQvdGC0LjRhNC40LrQsNGC0L7RgCDQv9GA0LjQu9C+0LbQtdC90LjRj1xuICogQHBhcmFtIHtzdHJpbmd9IHNlY3JldCDQv9Cw0YDQvtC70Ywg0L/RgNC40LvQvtC20LXQvdC40Y9cbiAqIEByZXR1cm5zIHtvYmplY3R9IEtleVZhdWx0Q2xpZW50XG4gKi9cbmZ1bmN0aW9uIGdldENsaWVudChjbGllbnRJZCwgc2VjcmV0KSB7XG4gIHRyeSB7XG4gICAgLy8gQ2FsbGJhY2sgZm9yIEFEQUwgYXV0aGVudGljYXRpb24uXG4gICAgY29uc3QgYWRhbENhbGxiYWNrID0gKGNoYWxsZW5nZSwgY2FsbGJhY2spID0+IHtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBuZXcgQXV0aGVudGljYXRpb25Db250ZXh0KGNoYWxsZW5nZS5hdXRob3JpemF0aW9uKTtcbiAgICAgIHJldHVybiBjb250ZXh0LmFjcXVpcmVUb2tlbldpdGhDbGllbnRDcmVkZW50aWFscyhcbiAgICAgICAgY2hhbGxlbmdlLnJlc291cmNlLFxuICAgICAgICBjbGllbnRJZCxcbiAgICAgICAgc2VjcmV0LFxuICAgICAgICAoZXJyLCB0b2tlblJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFRoZSBLZXlWYXVsdENyZWRlbnRpYWxzIGNhbGxiYWNrIGV4cGVjdHMgYW4gZXJyb3IsIGlmIGFueSwgYXMgdGhlIGZpcnN0IHBhcmFtZXRlci5cbiAgICAgICAgICAvLyBJdCB0aGVuIGV4cGVjdHMgYSB2YWx1ZSBmb3IgdGhlIEhUVFAgJ0F1dGhvcml6YXRpb24nIGhlYWRlciwgd2hpY2ggd2UgY29tcHV0ZSBiYXNlZCB1cG9uIHRoZSBhY2Nlc3MgdG9rZW4gb2J0YWluZWQgd2l0aCB0aGUgU1AgY2xpZW50IGNyZWRlbnRpYWxzLlxuICAgICAgICAgIC8vIFRoZSB0b2tlbiB0eXBlIHdpbGwgZ2VuZXJhbGx5IGVxdWFsICdCZWFyZXInIC0gaW4gc29tZSB1c2VyLXNwZWNpZmljIHNpdHVhdGlvbnMsIGEgZGlmZmVyZW50IHR5cGUgb2YgdG9rZW4gbWF5IGJlIGlzc3VlZC5cbiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgYCR7dG9rZW5SZXNwb25zZS50b2tlblR5cGV9ICR7dG9rZW5SZXNwb25zZS5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9O1xuXG4gICAgY29uc3Qga2V5VmF1bHRDbGllbnQgPSBuZXcgS2V5VmF1bHQuS2V5VmF1bHRDbGllbnQoXG4gICAgICBuZXcgS2V5VmF1bHQuS2V5VmF1bHRDcmVkZW50aWFscyhhZGFsQ2FsbGJhY2spXG4gICAgKTtcblxuICAgIHJldHVybiBrZXlWYXVsdENsaWVudDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgVkVycm9yKFxuICAgICAgeyBuYW1lOiBcIktleVZhdWx0RXJyb3JcIiwgY2F1c2U6IGVycm9yIH0sXG4gICAgICBcIkZhaWxlZCB0byBjcmVhdGUgS2V5VmF1bHQgY2xpZW50XCJcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdldENsaWVudDtcbiIsImltcG9ydCBWRXJyb3IgZnJvbSBcInZlcnJvclwiO1xuaW1wb3J0IEtleVZhdWx0IGZyb20gXCJhenVyZS1rZXl2YXVsdFwiO1xuaW1wb3J0IGdldENsaWVudCBmcm9tIFwiLi9jbGllbnRcIjtcblxuLyoqXG4gKiDQodC+0LfQtNCw0L3QuNC1INC90L7QstC+0LPQviDQutC70Y7Rh9CwXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBBenVyZSBLZXkgVmF1bHQgVVJJXG4gKiBAcGFyYW0ge3N0cmluZ30gY2xpZW50SWQgQXp1cmUgS2V5IFZhdWx0IENsaWVudCBJZCAoU2VydmljZSBwcmluY2lwYWwpXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwU2VjcmV0IEF6dXJlIEtleSBWYXVsdCBBcHBsaWNhdGlvbiBTZWNyZXRcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXlOYW1lINC40LzRj1xuICogQHJldHVybnMge3N0cmluZ30g0LLQtdGA0YHQuNGPXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUtleSh7IHVyaSwgY2xpZW50SWQsIGFwcFNlY3JldCwga2V5TmFtZSB9KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qga2V5VmF1bHRDbGllbnQgPSBnZXRDbGllbnQoY2xpZW50SWQsIGFwcFNlY3JldCk7XG5cbiAgICBjb25zdCBrZXlPcGVyYXRpb25zID0gW1wiZW5jcnlwdFwiLCBcImRlY3J5cHRcIl07XG4gICAgY29uc3Qga2V5T3B0aW9ucyA9IHtcbiAgICAgIGtleVNpemU6IDQwOTYsXG4gICAgICBrZXlPcHM6IGtleU9wZXJhdGlvbnNcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQga2V5VmF1bHRDbGllbnQuY3JlYXRlS2V5KFxuICAgICAgdXJpLFxuICAgICAga2V5TmFtZSxcbiAgICAgIFwiUlNBXCIsXG4gICAgICBrZXlPcHRpb25zXG4gICAgKTtcblxuICAgIGNvbnN0IGtleUlkID0gS2V5VmF1bHQucGFyc2VLZXlJZGVudGlmaWVyKHJlc3VsdC5rZXkua2lkKTtcbiAgICByZXR1cm4ga2V5SWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IFZFcnJvcihcbiAgICAgIHsgbmFtZTogXCJLZXlWYXVsdEVycm9yXCIsIGNhdXNlOiBlcnJvciB9LFxuICAgICAgXCJGYWlsZWQgdG8gY3JlYXRlIG5ldyBrZXlcIlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlS2V5O1xuIiwiaW1wb3J0IFZFcnJvciBmcm9tIFwidmVycm9yXCI7XG5pbXBvcnQgZ2V0Q2xpZW50IGZyb20gXCIuL2NsaWVudFwiO1xuXG4vKipcbiAqINCo0LjRhNGA0L7QstCw0L3QuNC1INGB0L7QvtCx0YnQtdC90LjRj1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgQXp1cmUgS2V5IFZhdWx0IFVSSVxuICogQHBhcmFtIHtzdHJpbmd9IGNsaWVudElkIEF6dXJlIEtleSBWYXVsdCBDbGllbnQgSWQgKFNlcnZpY2UgcHJpbmNpcGFsKVxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFNlY3JldCBBenVyZSBLZXkgVmF1bHQgQXBwbGljYXRpb24gU2VjcmV0XG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUg0YHQvtC+0LHRidC10L3QuNC1XG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5TmFtZSDQuNC80Y8g0LrQu9GO0YfQsFxuICogQHBhcmFtIHtzdHJpbmd9IGtleVZlcnNpb24g0LLQtdGA0YHQuNGPINC60LvRjtGH0LBcbiAqIEByZXR1cm5zIHtqc29ufSDQt9Cw0YjQuNGE0YDQvtCy0LDQvdC90L7QtSDRgdC+0L7QsdGJ0LXQvdC40LVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZW5jcnlwdCh7XG4gIHVyaSxcbiAgY2xpZW50SWQsXG4gIGFwcFNlY3JldCxcbiAgdmFsdWUsXG4gIGtleU5hbWUsXG4gIGtleVZlcnNpb24gPSBcIlwiXG59KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qga2V5VmF1bHRDbGllbnQgPSBnZXRDbGllbnQoY2xpZW50SWQsIGFwcFNlY3JldCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZXlWYXVsdENsaWVudC5lbmNyeXB0KFxuICAgICAgdXJpLFxuICAgICAga2V5TmFtZSxcbiAgICAgIGtleVZlcnNpb24sXG4gICAgICBcIlJTQS1PQUVQXCIsXG4gICAgICBCdWZmZXIuZnJvbSh2YWx1ZSlcbiAgICApO1xuXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHJlc3VsdC5yZXN1bHQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBWRXJyb3IoXG4gICAgICB7IG5hbWU6IFwiS2V5VmF1bHRFcnJvclwiLCBjYXVzZTogZXJyb3IgfSxcbiAgICAgIFwiRmFpbGVkIHRvIGVuY3J5cHQgdmFsdWVcIlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgZW5jcnlwdDtcbiIsImltcG9ydCBWRXJyb3IgZnJvbSBcInZlcnJvclwiO1xuaW1wb3J0IEtleVZhdWx0IGZyb20gXCJhenVyZS1rZXl2YXVsdFwiO1xuaW1wb3J0IGdldENsaWVudCBmcm9tIFwiLi9jbGllbnRcIjtcblxuLyoqXG4gKiDQodC+0YXRgNCw0L3QtdC90LjQtSDRgdC10LrRgNC10YLQsCDQsiDRhdGA0LDQvdC40LvQuNGJ0LVcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIEF6dXJlIEtleSBWYXVsdCBVUklcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCBBenVyZSBLZXkgVmF1bHQgQ2xpZW50IElkIChTZXJ2aWNlIHByaW5jaXBhbClcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBTZWNyZXQgQXp1cmUgS2V5IFZhdWx0IEFwcGxpY2F0aW9uIFNlY3JldFxuICogQHBhcmFtIHtzdHJpbmd9IHNlY3JldFZhbHVlINC30L3QsNGH0LXQvdC40LVcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZWNyZXROYW1lINC40LzRj1xuICogQHJldHVybnMge2pzb259INC40LTQtdC90YLQuNGE0LjQutCw0YLQvtGAXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNldFNlY3JldCh7XG4gIHVyaSxcbiAgY2xpZW50SWQsXG4gIGFwcFNlY3JldCxcbiAgc2VjcmV0VmFsdWUsXG4gIHNlY3JldE5hbWVcbn0pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBrZXlWYXVsdENsaWVudCA9IGdldENsaWVudChjbGllbnRJZCwgYXBwU2VjcmV0KTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZXlWYXVsdENsaWVudC5zZXRTZWNyZXQodXJpLCBzZWNyZXROYW1lLCBzZWNyZXRWYWx1ZSk7XG4gICAgY29uc3Qgc2VjcmV0SWQgPSBLZXlWYXVsdC5wYXJzZVNlY3JldElkZW50aWZpZXIocmVzdWx0LmlkKTtcbiAgICByZXR1cm4gc2VjcmV0SWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IFZFcnJvcihcbiAgICAgIHsgbmFtZTogXCJLZXlWYXVsdEVycm9yXCIsIGNhdXNlOiBlcnJvciB9LFxuICAgICAgXCJGYWlsZWQgdG8gc2V0IHNlY3JldFwiXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBzZXRTZWNyZXQ7XG4iLCJpbXBvcnQgeyB2NCBhcyB1dWlkIH0gZnJvbSBcInV1aWRcIjtcbmltcG9ydCB7IGNyZWF0ZUtleSwgZW5jcnlwdCwgc2V0U2VjcmV0IH0gZnJvbSBcImNwektleVZhdWx0XCI7XG5pbXBvcnQgZG90ZW52IGZyb20gXCJkb3RlbnYtc2FmZVwiO1xuXG5kb3RlbnYuY29uZmlnKCk7XG5jb25zdCB7XG4gIEtFWV9WQVVMVF9VUkwsXG4gIEtFWV9WQVVMVF9XUklURV9DTElFTlRfSUQsXG4gIEtFWV9WQVVMVF9XUklURV9BUFBfU0VDUkVUXG59ID0gcHJvY2Vzcy5lbnY7XG5hc3luYyBmdW5jdGlvbiBlbmNyeXB0QW5kU2F2ZShrZXlOYW1lLCBzZWNyZXROYW1lLCB2YWx1ZSkge1xuICBhd2FpdCBjcmVhdGVLZXkoe1xuICAgIHVyaTogS0VZX1ZBVUxUX1VSTCxcbiAgICBjbGllbnRJZDogS0VZX1ZBVUxUX1dSSVRFX0NMSUVOVF9JRCxcbiAgICBhcHBTZWNyZXQ6IEtFWV9WQVVMVF9XUklURV9BUFBfU0VDUkVULFxuICAgIGtleU5hbWVcbiAgfSk7XG4gIGNvbnN0IGVuY3J5cHRlZERhdGEgPSBhd2FpdCBlbmNyeXB0KHtcbiAgICB1cmk6IEtFWV9WQVVMVF9VUkwsXG4gICAgY2xpZW50SWQ6IEtFWV9WQVVMVF9XUklURV9DTElFTlRfSUQsXG4gICAgYXBwU2VjcmV0OiBLRVlfVkFVTFRfV1JJVEVfQVBQX1NFQ1JFVCxcbiAgICB2YWx1ZSxcbiAgICBrZXlOYW1lXG4gIH0pO1xuICBjb25zdCBzZWNyZXQgPSBhd2FpdCBzZXRTZWNyZXQoe1xuICAgIHVyaTogS0VZX1ZBVUxUX1VSTCxcbiAgICBjbGllbnRJZDogS0VZX1ZBVUxUX1dSSVRFX0NMSUVOVF9JRCxcbiAgICBhcHBTZWNyZXQ6IEtFWV9WQVVMVF9XUklURV9BUFBfU0VDUkVULFxuICAgIHNlY3JldFZhbHVlOiBlbmNyeXB0ZWREYXRhLFxuICAgIHNlY3JldE5hbWVcbiAgfSk7XG4gIHJldHVybiBzZWNyZXQudmVyc2lvbjtcbn1cbmFzeW5jIGZ1bmN0aW9uIHNhdmVBUElLZXlzKGFyZ3MpIHtcbiAgdGhpcy5sb2coYXJncyk7XG4gIGNvbnN0IHsgQVBJS2V5LCBBUElTZWNyZXQgfSA9IGFyZ3M7XG4gIGNvbnN0IHtcbiAgICB1c2VyLFxuICAgIHNwYXJlLFxuICAgIEFQSUtleUVuY3JLZXlOYW1lLFxuICAgIEFQSVNlY3JldEVuY3JLZXlOYW1lLFxuICAgIEFQSUtleVNlY3JldE5hbWUsXG4gICAgQVBJU2VjcmV0U2VjcmV0TmFtZVxuICB9ID0gYXJncy5vcHRpb25zO1xuXG4gIGNvbnN0IGluZm8gPSB7XG4gICAgQVBJS2V5OiB7fSxcbiAgICBBUElTZWNyZXQ6IHt9XG4gIH07XG4gIGlmICh1c2VyKSB7XG4gICAgaW5mby5BUElLZXkuZW5jcnlwdGlvbktleU5hbWUgPSB1c2VyLnRvU3RyaW5nKCk7XG4gICAgaW5mby5BUElTZWNyZXQuZW5jcnlwdGlvbktleU5hbWUgPSB1c2VyLnRvU3RyaW5nKCk7XG4gICAgaW5mby5BUElLZXkubmFtZSA9IHVzZXIudG9TdHJpbmcoKTtcbiAgICBpbmZvLkFQSVNlY3JldC5uYW1lID0gdXNlci50b1N0cmluZygpO1xuICB9XG4gIGluZm8uQVBJS2V5LmVuY3J5cHRpb25LZXlOYW1lID1cbiAgICBBUElLZXlFbmNyS2V5TmFtZSB8fCBpbmZvLkFQSUtleS5lbmNyeXB0aW9uS2V5TmFtZSB8fCB1dWlkKCk7XG4gIGluZm8uQVBJU2VjcmV0LmVuY3J5cHRpb25LZXlOYW1lID1cbiAgICBBUElTZWNyZXRFbmNyS2V5TmFtZSB8fCBpbmZvLkFQSVNlY3JldC5lbmNyeXB0aW9uS2V5TmFtZSB8fCB1dWlkKCk7XG4gIGluZm8uQVBJS2V5Lm5hbWUgPSBBUElLZXlTZWNyZXROYW1lIHx8IGluZm8uQVBJS2V5Lm5hbWUgfHwgdXVpZCgpO1xuICBpbmZvLkFQSVNlY3JldC5uYW1lID0gQVBJU2VjcmV0U2VjcmV0TmFtZSB8fCBpbmZvLkFQSVNlY3JldC5uYW1lIHx8IHV1aWQoKTtcbiAgaW5mby5BUElLZXkudmVyc2lvbiA9IGF3YWl0IGVuY3J5cHRBbmRTYXZlKFxuICAgIGluZm8uQVBJS2V5LmVuY3J5cHRpb25LZXlOYW1lLFxuICAgIGluZm8uQVBJS2V5Lm5hbWUsXG4gICAgQVBJS2V5XG4gICk7XG4gIGluZm8uQVBJU2VjcmV0LnZlcnNpb24gPSBhd2FpdCBlbmNyeXB0QW5kU2F2ZShcbiAgICBpbmZvLkFQSVNlY3JldC5lbmNyeXB0aW9uS2V5TmFtZSxcbiAgICBpbmZvLkFQSVNlY3JldC5uYW1lLFxuICAgIEFQSVNlY3JldFxuICApO1xuXG4gIGNvbnN0IGtleXMgPSB7fTtcbiAgaWYgKHNwYXJlKSB7XG4gICAga2V5cy5zcGFyZSA9IGluZm87XG4gIH0gZWxzZSB7XG4gICAga2V5cy5tYWluID0gaW5mbztcbiAgfVxuXG4gIHRoaXMubG9nKEpTT04uc3RyaW5naWZ5KGtleXMpKTtcbn1cblxuZXhwb3J0IHsgc2F2ZUFQSUtleXMgfTtcbiIsImltcG9ydCBcImJhYmVsLXBvbHlmaWxsXCI7XG5pbXBvcnQgVm9ycGFsIGZyb20gXCJ2b3JwYWxcIjtcblxuaW1wb3J0IHsgc2F2ZUFQSUtleXMgfSBmcm9tIFwiLi9rZXlWYXVsdFwiO1xuXG5jb25zdCB2b3JwYWwgPSBuZXcgVm9ycGFsKCk7XG52b3JwYWxcbiAgLmNvbW1hbmQoXG4gICAgXCJrdiBzYXZlIGFwaS1rZXlzIDxBUElLZXk+IDxBUElTZWNyZXQ+XCIsXG4gICAgXCJFbmNyeXB0IGFuZCBzYXZlIEV4Y2hhbmdlIEFQSSBLZXlzIHRvIEtleSBWYXVsdC5cIlxuICApXG4gIC5vcHRpb24oXCItdSwgLS11c2VyIDx1c2VySWQ+XCIsIFwiVXNlIHVzZXJJZCBhcyBuYW1lXCIpXG4gIC5vcHRpb24oXCItcywgLS1zcGFyZVwiLCBcIlNhdmUgc3BhcmUga2V5cy5cIilcbiAgLm9wdGlvbihcbiAgICBcIi0tQVBJS2V5RW5jcktleU5hbWUgPEFQSUtleUVuY3JLZXlOYW1lPlwiLFxuICAgIFwiRW5jcnlwdGlvbiBrZXkgbmFtZSBmb3IgQVBJIEtleS5cIlxuICApXG4gIC5vcHRpb24oXG4gICAgXCItLUFQSVNlY3JldEVuY3JLZXlOYW1lIDxBUElTZWNyZXRFbmNyS2V5TmFtZT5cIixcbiAgICBcIkVuY3J5cHRpb24ga2V5IG5hbWUgZm9yIEFQSSBTZWNyZXQuXCJcbiAgKVxuICAub3B0aW9uKFxuICAgIFwiLS1BUElLZXlTZWNyZXROYW1lIDxBUElLZXlTZWNyZXROYW1lPlwiLFxuICAgIFwiTmFtZSBvZiBzZWNyZXQgZm9yIEFQSSBLZXkuXCJcbiAgKVxuICAub3B0aW9uKFxuICAgIFwiLS1BUElTZWNyZXRTZWNyZXROYW1lIDxBUElTZWNyZXRTZWNyZXROYW1lPlwiLFxuICAgIFwiTmFtZSBvZiBzZWNyZXQgZm9yIEFQSSBTZWNyZXQuXCJcbiAgKVxuICAuYWN0aW9uKHNhdmVBUElLZXlzKTtcblxudm9ycGFsLmRlbGltaXRlcihcImNweiRcIikuc2hvdygpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiYWRhbC1ub2RlXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImF6dXJlLWtleXZhdWx0XCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImJhYmVsLXBvbHlmaWxsXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImRvdGVudi1zYWZlXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcInV1aWRcIik7IiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwidmVycm9yXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcInZvcnBhbFwiKTsiXSwic291cmNlUm9vdCI6IiJ9