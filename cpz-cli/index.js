require("source-map-support").install(),module.exports=function(e){var r={};function t(n){if(r[n])return r[n].exports;var a=r[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:n})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)t.d(n,a,function(r){return e[r]}.bind(null,a));return n},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s="./src/index.js")}({"./src/index.js":function(e,r,t){"use strict";t.r(r);t("babel-polyfill");var n=t("vorpal"),a=t.n(n),o=t("@babel/runtime/regenerator"),c=t.n(o),i=t("@babel/runtime/helpers/asyncToGenerator"),u=t.n(i),s=t("uuid"),p=t("verror"),y=t.n(p),l=t("azure-keyvault"),f=t.n(l),v=t("adal-node");var m=function(e,r){try{return new f.a.KeyVaultClient(new f.a.KeyVaultCredentials(function(t,n){return new v.AuthenticationContext(t.authorization).acquireTokenWithClientCredentials(t.resource,e,r,function(e,r){if(e)throw e;return n(null,"".concat(r.tokenType," ").concat(r.accessToken))})}))}catch(e){throw new y.a({name:"KeyVaultError",cause:e},"Failed to create KeyVault client")}};function d(e,r,t,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function I(){var e;return e=regeneratorRuntime.mark(function e(r){var t,n,a,o,c,i,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.uri,n=r.clientId,a=r.appSecret,o=r.keyName,e.prev=1,c=m(n,a),i={keySize:4096,keyOps:["encrypt","decrypt"]},e.next=7,c.createKey(t,o,"RSA",i);case 7:return u=e.sent,s=f.a.parseKeyIdentifier(u.key.kid),e.abrupt("return",s);case 12:throw e.prev=12,e.t0=e.catch(1),new y.a({name:"KeyVaultError",cause:e.t0},"Failed to create new key");case 15:case"end":return e.stop()}},e,this,[[1,12]])}),(I=function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function c(e){d(o,n,a,c,i,"next",e)}function i(e){d(o,n,a,c,i,"throw",e)}c(void 0)})}).apply(this,arguments)}var P=function(e){return I.apply(this,arguments)};function h(e,r,t,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function S(){var e;return e=regeneratorRuntime.mark(function e(r){var t,n,a,o,c,i,u,s,p;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.uri,n=r.clientId,a=r.appSecret,o=r.value,c=r.keyName,i=r.keyVersion,u=void 0===i?"":i,e.prev=1,s=m(n,a),e.next=5,s.encrypt(t,c,u,"RSA-OAEP",Buffer.from(o));case 5:return p=e.sent,e.abrupt("return",JSON.stringify(p.result));case 9:throw e.prev=9,e.t0=e.catch(1),new y.a({name:"KeyVaultError",cause:e.t0},"Failed to encrypt value");case 12:case"end":return e.stop()}},e,this,[[1,9]])}),(S=function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function c(e){h(o,n,a,c,i,"next",e)}function i(e){h(o,n,a,c,i,"throw",e)}c(void 0)})}).apply(this,arguments)}var A=function(e){return S.apply(this,arguments)};function K(e,r,t,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void t(e)}i.done?r(u):Promise.resolve(u).then(n,a)}function b(){var e;return e=regeneratorRuntime.mark(function e(r){var t,n,a,o,c,i,u,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.uri,n=r.clientId,a=r.appSecret,o=r.secretValue,c=r.secretName,e.prev=1,i=m(n,a),e.next=5,i.setSecret(t,c,o);case 5:return u=e.sent,s=f.a.parseSecretIdentifier(u.id),e.abrupt("return",s);case 10:throw e.prev=10,e.t0=e.catch(1),new y.a({name:"KeyVaultError",cause:e.t0},"Failed to set secret");case 13:case"end":return e.stop()}},e,this,[[1,10]])}),(b=function(){var r=this,t=arguments;return new Promise(function(n,a){var o=e.apply(r,t);function c(e){K(o,n,a,c,i,"next",e)}function i(e){K(o,n,a,c,i,"throw",e)}c(void 0)})}).apply(this,arguments)}var x=function(e){return b.apply(this,arguments)},w=t("dotenv-safe");t.n(w).a.config();var N=process.env,k=N.KEY_VAULT_URL,g=N.KEY_VAULT_WRITE_CLIENT_ID,E=N.KEY_VAULT_WRITE_APP_SECRET;function _(e,r,t){return O.apply(this,arguments)}function O(){return(O=u()(c.a.mark(function e(r,t,n){var a,o;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P({uri:k,clientId:g,appSecret:E,keyName:r});case 2:return e.next=4,A({uri:k,clientId:g,appSecret:E,value:n,keyName:r});case 4:return a=e.sent,e.next=7,x({uri:k,clientId:g,appSecret:E,secretValue:a,secretName:t});case 7:return o=e.sent,e.abrupt("return",o.version);case 9:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}function T(){return(T=u()(c.a.mark(function e(r){var t,n,a,o,i,u,p,y,l,f,v;return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.log(r),t=r.APIKey,n=r.APISecret,a=r.options,o=a.user,i=a.spare,u=a.APIKeyEncrKeyName,p=a.APISecretEncrKeyName,y=a.APIKeySecretName,l=a.APISecretSecretName,f={APIKey:{},APISecret:{}},o&&(f.APIKey.encryptionKeyName=o.toString(),f.APISecret.encryptionKeyName=o.toString(),f.APIKey.name=o.toString(),f.APISecret.name=o.toString()),f.APIKey.encryptionKeyName=u||f.APIKey.encryptionKeyName||Object(s.v4)(),f.APISecret.encryptionKeyName=p||f.APISecret.encryptionKeyName||Object(s.v4)(),f.APIKey.name=y||f.APIKey.name||Object(s.v4)(),f.APISecret.name=l||f.APISecret.name||Object(s.v4)(),e.next=11,_(f.APIKey.encryptionKeyName,f.APIKey.name,t);case 11:return f.APIKey.version=e.sent,e.next=14,_(f.APISecret.encryptionKeyName,f.APISecret.name,n);case 14:f.APISecret.version=e.sent,v={},i?v.spare=f:v.main=f,this.log(JSON.stringify(v));case 18:case"end":return e.stop()}},e,this)}))).apply(this,arguments)}var V=new a.a;V.command("kv save api-keys <APIKey> <APISecret>","Encrypt and save Exchange API Keys to Key Vault.").option("-u, --user <userId>","Use userId as name").option("-s, --spare","Save spare keys.").option("--APIKeyEncrKeyName <APIKeyEncrKeyName>","Encryption key name for API Key.").option("--APISecretEncrKeyName <APISecretEncrKeyName>","Encryption key name for API Secret.").option("--APIKeySecretName <APIKeySecretName>","Name of secret for API Key.").option("--APISecretSecretName <APISecretSecretName>","Name of secret for API Secret.").action(function(e){return T.apply(this,arguments)}),V.delimiter("cpz$").show()},"@babel/runtime/helpers/asyncToGenerator":function(e,r){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},"@babel/runtime/regenerator":function(e,r){e.exports=require("@babel/runtime/regenerator")},"adal-node":function(e,r){e.exports=require("adal-node")},"azure-keyvault":function(e,r){e.exports=require("azure-keyvault")},"babel-polyfill":function(e,r){e.exports=require("babel-polyfill")},"dotenv-safe":function(e,r){e.exports=require("dotenv-safe")},uuid:function(e,r){e.exports=require("uuid")},verror:function(e,r){e.exports=require("verror")},vorpal:function(e,r){e.exports=require("vorpal")}});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4uL2Nwei1zaGFyZWQva2V5VmF1bHQvY2xpZW50LmpzIiwid2VicGFjazovLy8uLi9jcHotc2hhcmVkL2tleVZhdWx0L2NyZWF0ZUtleS5qcyIsIndlYnBhY2s6Ly8vLi4vY3B6LXNoYXJlZC9rZXlWYXVsdC9lbmNyeXB0LmpzIiwid2VicGFjazovLy8uLi9jcHotc2hhcmVkL2tleVZhdWx0L3NldFNlY3JldC5qcyIsIndlYnBhY2s6Ly8vLi9zcmMva2V5VmF1bHQvaW5kZXguanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIiwid2VicGFjazovLy9leHRlcm5hbCBcIkBiYWJlbC9ydW50aW1lL2hlbHBlcnMvYXN5bmNUb0dlbmVyYXRvclwiIiwid2VicGFjazovLy9leHRlcm5hbCBcIkBiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yXCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiYWRhbC1ub2RlXCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwiYXp1cmUta2V5dmF1bHRcIiIsIndlYnBhY2s6Ly8vZXh0ZXJuYWwgXCJiYWJlbC1wb2x5ZmlsbFwiIiwid2VicGFjazovLy9leHRlcm5hbCBcImRvdGVudi1zYWZlXCIiLCJ3ZWJwYWNrOi8vL2V4dGVybmFsIFwidXVpZFwiIiwid2VicGFjazovLy9leHRlcm5hbCBcInZlcnJvclwiIiwid2VicGFjazovLy9leHRlcm5hbCBcInZvcnBhbFwiIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwiZ2V0Q2xpZW50IiwiY2xpZW50SWQiLCJzZWNyZXQiLCJLZXlWYXVsdCIsIktleVZhdWx0Q2xpZW50IiwiS2V5VmF1bHRDcmVkZW50aWFscyIsImNoYWxsZW5nZSIsImNhbGxiYWNrIiwiQXV0aGVudGljYXRpb25Db250ZXh0IiwiYXV0aG9yaXphdGlvbiIsImFjcXVpcmVUb2tlbldpdGhDbGllbnRDcmVkZW50aWFscyIsInJlc291cmNlIiwiZXJyIiwidG9rZW5SZXNwb25zZSIsImNvbmNhdCIsInRva2VuVHlwZSIsImFjY2Vzc1Rva2VuIiwiZXJyb3IiLCJWRXJyb3IiLCJjYXVzZSIsIl9jYWxsZWUiLCJfcmVmIiwidXJpIiwiYXBwU2VjcmV0Iiwia2V5TmFtZSIsImtleVZhdWx0Q2xpZW50Iiwia2V5T3B0aW9ucyIsInJlc3VsdCIsImtleUlkIiwicmVnZW5lcmF0b3JSdW50aW1lIiwid3JhcCIsIl9jb250ZXh0IiwicHJldiIsIm5leHQiLCJrZXlTaXplIiwia2V5T3BzIiwiY3JlYXRlS2V5Iiwic2VudCIsInBhcnNlS2V5SWRlbnRpZmllciIsImtpZCIsImFicnVwdCIsInQwIiwic3RvcCIsInRoaXMiLCJfcmVmJGtleVZlcnNpb24iLCJrZXlWZXJzaW9uIiwiZW5jcnlwdCIsIkJ1ZmZlciIsImZyb20iLCJKU09OIiwic3RyaW5naWZ5Iiwic2VjcmV0VmFsdWUiLCJzZWNyZXROYW1lIiwic2VjcmV0SWQiLCJzZXRTZWNyZXQiLCJwYXJzZVNlY3JldElkZW50aWZpZXIiLCJpZCIsImRvdGVudiIsImNvbmZpZyIsInByb2Nlc3MiLCJlbnYiLCJLRVlfVkFVTFRfVVJMIiwiS0VZX1ZBVUxUX1dSSVRFX0NMSUVOVF9JRCIsIktFWV9WQVVMVF9XUklURV9BUFBfU0VDUkVUIiwiZW5jcnlwdEFuZFNhdmUiLCJlbmNyeXB0ZWREYXRhIiwicmVnZW5lcmF0b3JfZGVmYXVsdCIsImEiLCJ2ZXJzaW9uIiwiX2NhbGxlZTIiLCJhcmdzIiwiQVBJS2V5IiwiQVBJU2VjcmV0IiwiX2FyZ3Mkb3B0aW9ucyIsInVzZXIiLCJzcGFyZSIsIkFQSUtleUVuY3JLZXlOYW1lIiwiQVBJU2VjcmV0RW5jcktleU5hbWUiLCJBUElLZXlTZWNyZXROYW1lIiwiQVBJU2VjcmV0U2VjcmV0TmFtZSIsImluZm8iLCJrZXlzIiwiX2NvbnRleHQyIiwibG9nIiwib3B0aW9ucyIsImVuY3J5cHRpb25LZXlOYW1lIiwidG9TdHJpbmciLCJ1dWlkIiwibWFpbiIsInZvcnBhbCIsIlZvcnBhbCIsImNvbW1hbmQiLCJvcHRpb24iLCJhY3Rpb24iLCJkZWxpbWl0ZXIiLCJzaG93IiwicmVxdWlyZSJdLCJtYXBwaW5ncyI6Im1FQUNBLElBQUFBLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQUMsUUFHQSxJQUFBQyxFQUFBSixFQUFBRSxHQUFBLENBQ0FHLEVBQUFILEVBQ0FJLEdBQUEsRUFDQUgsUUFBQSxJQVVBLE9BTkFJLEVBQUFMLEdBQUFNLEtBQUFKLEVBQUFELFFBQUFDLElBQUFELFFBQUFGLEdBR0FHLEVBQUFFLEdBQUEsRUFHQUYsRUFBQUQsUUEwREEsT0FyREFGLEVBQUFRLEVBQUFGLEVBR0FOLEVBQUFTLEVBQUFWLEVBR0FDLEVBQUFVLEVBQUEsU0FBQVIsRUFBQVMsRUFBQUMsR0FDQVosRUFBQWEsRUFBQVgsRUFBQVMsSUFDQUcsT0FBQUMsZUFBQWIsRUFBQVMsRUFBQSxDQUEwQ0ssWUFBQSxFQUFBQyxJQUFBTCxLQUsxQ1osRUFBQWtCLEVBQUEsU0FBQWhCLEdBQ0Esb0JBQUFpQixlQUFBQyxhQUNBTixPQUFBQyxlQUFBYixFQUFBaUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQWIsRUFBQSxjQUFpRG1CLE9BQUEsS0FRakRyQixFQUFB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Qyx3Q0FDQSwrQkFFREEsT0FDQyw4Q0FDQSxrQ0FFREMsb0RBRUhKLEVBQU9LLFVBQVUsUUFBUUMsZ0VDL0J6QmhJLEVBQUFELFFBQUFrSSxRQUFBLHVGQ0FBakksRUFBQUQsUUFBQWtJLFFBQUEseURDQUFqSSxFQUFBRCxRQUFBa0ksUUFBQSw2Q0NBQWpJLEVBQUFELFFBQUFrSSxRQUFBLGtEQ0FBakksRUFBQUQsUUFBQWtJLFFBQUEsK0NDQUFqSSxFQUFBRCxRQUFBa0ksUUFBQSxtQ0NBQWpJLEVBQUFELFFBQUFrSSxRQUFBLDhCQ0FBakksRUFBQUQsUUFBQWtJLFFBQUEsZ0NDQUFqSSxFQUFBRCxRQUFBa0ksUUFBQSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSBcIi4vc3JjL2luZGV4LmpzXCIpO1xuIiwiaW1wb3J0IFZFcnJvciBmcm9tIFwidmVycm9yXCI7XG5pbXBvcnQgS2V5VmF1bHQgZnJvbSBcImF6dXJlLWtleXZhdWx0XCI7XG5pbXBvcnQgeyBBdXRoZW50aWNhdGlvbkNvbnRleHQgfSBmcm9tIFwiYWRhbC1ub2RlXCI7XG5cbi8qKlxuICog0JrQu9C40LXQvdGCINC6INGB0LvRg9C20LHQtSBBenVyZSBLZXlWYXVsdFxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCDQuNC00LXQvdGC0LjRhNC40LrQsNGC0L7RgCDQv9GA0LjQu9C+0LbQtdC90LjRj1xuICogQHBhcmFtIHtzdHJpbmd9IHNlY3JldCDQv9Cw0YDQvtC70Ywg0L/RgNC40LvQvtC20LXQvdC40Y9cbiAqIEByZXR1cm5zIHtvYmplY3R9IEtleVZhdWx0Q2xpZW50XG4gKi9cbmZ1bmN0aW9uIGdldENsaWVudChjbGllbnRJZCwgc2VjcmV0KSB7XG4gIHRyeSB7XG4gICAgLy8gQ2FsbGJhY2sgZm9yIEFEQUwgYXV0aGVudGljYXRpb24uXG4gICAgY29uc3QgYWRhbENhbGxiYWNrID0gKGNoYWxsZW5nZSwgY2FsbGJhY2spID0+IHtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBuZXcgQXV0aGVudGljYXRpb25Db250ZXh0KGNoYWxsZW5nZS5hdXRob3JpemF0aW9uKTtcbiAgICAgIHJldHVybiBjb250ZXh0LmFjcXVpcmVUb2tlbldpdGhDbGllbnRDcmVkZW50aWFscyhcbiAgICAgICAgY2hhbGxlbmdlLnJlc291cmNlLFxuICAgICAgICBjbGllbnRJZCxcbiAgICAgICAgc2VjcmV0LFxuICAgICAgICAoZXJyLCB0b2tlblJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgdGhyb3cgZXJyO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIFRoZSBLZXlWYXVsdENyZWRlbnRpYWxzIGNhbGxiYWNrIGV4cGVjdHMgYW4gZXJyb3IsIGlmIGFueSwgYXMgdGhlIGZpcnN0IHBhcmFtZXRlci5cbiAgICAgICAgICAvLyBJdCB0aGVuIGV4cGVjdHMgYSB2YWx1ZSBmb3IgdGhlIEhUVFAgJ0F1dGhvcml6YXRpb24nIGhlYWRlciwgd2hpY2ggd2UgY29tcHV0ZSBiYXNlZCB1cG9uIHRoZSBhY2Nlc3MgdG9rZW4gb2J0YWluZWQgd2l0aCB0aGUgU1AgY2xpZW50IGNyZWRlbnRpYWxzLlxuICAgICAgICAgIC8vIFRoZSB0b2tlbiB0eXBlIHdpbGwgZ2VuZXJhbGx5IGVxdWFsICdCZWFyZXInIC0gaW4gc29tZSB1c2VyLXNwZWNpZmljIHNpdHVhdGlvbnMsIGEgZGlmZmVyZW50IHR5cGUgb2YgdG9rZW4gbWF5IGJlIGlzc3VlZC5cbiAgICAgICAgICByZXR1cm4gY2FsbGJhY2soXG4gICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgYCR7dG9rZW5SZXNwb25zZS50b2tlblR5cGV9ICR7dG9rZW5SZXNwb25zZS5hY2Nlc3NUb2tlbn1gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9O1xuXG4gICAgY29uc3Qga2V5VmF1bHRDbGllbnQgPSBuZXcgS2V5VmF1bHQuS2V5VmF1bHRDbGllbnQoXG4gICAgICBuZXcgS2V5VmF1bHQuS2V5VmF1bHRDcmVkZW50aWFscyhhZGFsQ2FsbGJhY2spXG4gICAgKTtcblxuICAgIHJldHVybiBrZXlWYXVsdENsaWVudDtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBuZXcgVkVycm9yKFxuICAgICAgeyBuYW1lOiBcIktleVZhdWx0RXJyb3JcIiwgY2F1c2U6IGVycm9yIH0sXG4gICAgICBcIkZhaWxlZCB0byBjcmVhdGUgS2V5VmF1bHQgY2xpZW50XCJcbiAgICApO1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IGdldENsaWVudDtcbiIsImltcG9ydCBWRXJyb3IgZnJvbSBcInZlcnJvclwiO1xuaW1wb3J0IEtleVZhdWx0IGZyb20gXCJhenVyZS1rZXl2YXVsdFwiO1xuaW1wb3J0IGdldENsaWVudCBmcm9tIFwiLi9jbGllbnRcIjtcblxuLyoqXG4gKiDQodC+0LfQtNCw0L3QuNC1INC90L7QstC+0LPQviDQutC70Y7Rh9CwXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHVyaSBBenVyZSBLZXkgVmF1bHQgVVJJXG4gKiBAcGFyYW0ge3N0cmluZ30gY2xpZW50SWQgQXp1cmUgS2V5IFZhdWx0IENsaWVudCBJZCAoU2VydmljZSBwcmluY2lwYWwpXG4gKiBAcGFyYW0ge3N0cmluZ30gYXBwU2VjcmV0IEF6dXJlIEtleSBWYXVsdCBBcHBsaWNhdGlvbiBTZWNyZXRcbiAqIEBwYXJhbSB7c3RyaW5nfSBrZXlOYW1lINC40LzRj1xuICogQHJldHVybnMge3N0cmluZ30g0LLQtdGA0YHQuNGPXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUtleSh7IHVyaSwgY2xpZW50SWQsIGFwcFNlY3JldCwga2V5TmFtZSB9KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qga2V5VmF1bHRDbGllbnQgPSBnZXRDbGllbnQoY2xpZW50SWQsIGFwcFNlY3JldCk7XG5cbiAgICBjb25zdCBrZXlPcGVyYXRpb25zID0gW1wiZW5jcnlwdFwiLCBcImRlY3J5cHRcIl07XG4gICAgY29uc3Qga2V5T3B0aW9ucyA9IHtcbiAgICAgIGtleVNpemU6IDQwOTYsXG4gICAgICBrZXlPcHM6IGtleU9wZXJhdGlvbnNcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQga2V5VmF1bHRDbGllbnQuY3JlYXRlS2V5KFxuICAgICAgdXJpLFxuICAgICAga2V5TmFtZSxcbiAgICAgIFwiUlNBXCIsXG4gICAgICBrZXlPcHRpb25zXG4gICAgKTtcblxuICAgIGNvbnN0IGtleUlkID0gS2V5VmF1bHQucGFyc2VLZXlJZGVudGlmaWVyKHJlc3VsdC5rZXkua2lkKTtcbiAgICByZXR1cm4ga2V5SWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IFZFcnJvcihcbiAgICAgIHsgbmFtZTogXCJLZXlWYXVsdEVycm9yXCIsIGNhdXNlOiBlcnJvciB9LFxuICAgICAgXCJGYWlsZWQgdG8gY3JlYXRlIG5ldyBrZXlcIlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlS2V5O1xuIiwiaW1wb3J0IFZFcnJvciBmcm9tIFwidmVycm9yXCI7XG5pbXBvcnQgZ2V0Q2xpZW50IGZyb20gXCIuL2NsaWVudFwiO1xuXG4vKipcbiAqINCo0LjRhNGA0L7QstCw0L3QuNC1INGB0L7QvtCx0YnQtdC90LjRj1xuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB1cmkgQXp1cmUgS2V5IFZhdWx0IFVSSVxuICogQHBhcmFtIHtzdHJpbmd9IGNsaWVudElkIEF6dXJlIEtleSBWYXVsdCBDbGllbnQgSWQgKFNlcnZpY2UgcHJpbmNpcGFsKVxuICogQHBhcmFtIHtzdHJpbmd9IGFwcFNlY3JldCBBenVyZSBLZXkgVmF1bHQgQXBwbGljYXRpb24gU2VjcmV0XG4gKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUg0YHQvtC+0LHRidC10L3QuNC1XG4gKiBAcGFyYW0ge3N0cmluZ30ga2V5TmFtZSDQuNC80Y8g0LrQu9GO0YfQsFxuICogQHBhcmFtIHtzdHJpbmd9IGtleVZlcnNpb24g0LLQtdGA0YHQuNGPINC60LvRjtGH0LBcbiAqIEByZXR1cm5zIHtqc29ufSDQt9Cw0YjQuNGE0YDQvtCy0LDQvdC90L7QtSDRgdC+0L7QsdGJ0LXQvdC40LVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZW5jcnlwdCh7XG4gIHVyaSxcbiAgY2xpZW50SWQsXG4gIGFwcFNlY3JldCxcbiAgdmFsdWUsXG4gIGtleU5hbWUsXG4gIGtleVZlcnNpb24gPSBcIlwiXG59KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qga2V5VmF1bHRDbGllbnQgPSBnZXRDbGllbnQoY2xpZW50SWQsIGFwcFNlY3JldCk7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZXlWYXVsdENsaWVudC5lbmNyeXB0KFxuICAgICAgdXJpLFxuICAgICAga2V5TmFtZSxcbiAgICAgIGtleVZlcnNpb24sXG4gICAgICBcIlJTQS1PQUVQXCIsXG4gICAgICBCdWZmZXIuZnJvbSh2YWx1ZSlcbiAgICApO1xuXG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHJlc3VsdC5yZXN1bHQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRocm93IG5ldyBWRXJyb3IoXG4gICAgICB7IG5hbWU6IFwiS2V5VmF1bHRFcnJvclwiLCBjYXVzZTogZXJyb3IgfSxcbiAgICAgIFwiRmFpbGVkIHRvIGVuY3J5cHQgdmFsdWVcIlxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgZW5jcnlwdDtcbiIsImltcG9ydCBWRXJyb3IgZnJvbSBcInZlcnJvclwiO1xuaW1wb3J0IEtleVZhdWx0IGZyb20gXCJhenVyZS1rZXl2YXVsdFwiO1xuaW1wb3J0IGdldENsaWVudCBmcm9tIFwiLi9jbGllbnRcIjtcblxuLyoqXG4gKiDQodC+0YXRgNCw0L3QtdC90LjQtSDRgdC10LrRgNC10YLQsCDQsiDRhdGA0LDQvdC40LvQuNGJ0LVcbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gdXJpIEF6dXJlIEtleSBWYXVsdCBVUklcbiAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCBBenVyZSBLZXkgVmF1bHQgQ2xpZW50IElkIChTZXJ2aWNlIHByaW5jaXBhbClcbiAqIEBwYXJhbSB7c3RyaW5nfSBhcHBTZWNyZXQgQXp1cmUgS2V5IFZhdWx0IEFwcGxpY2F0aW9uIFNlY3JldFxuICogQHBhcmFtIHtzdHJpbmd9IHNlY3JldFZhbHVlINC30L3QsNGH0LXQvdC40LVcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZWNyZXROYW1lINC40LzRj1xuICogQHJldHVybnMge2pzb259INC40LTQtdC90YLQuNGE0LjQutCw0YLQvtGAXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNldFNlY3JldCh7XG4gIHVyaSxcbiAgY2xpZW50SWQsXG4gIGFwcFNlY3JldCxcbiAgc2VjcmV0VmFsdWUsXG4gIHNlY3JldE5hbWVcbn0pIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBrZXlWYXVsdENsaWVudCA9IGdldENsaWVudChjbGllbnRJZCwgYXBwU2VjcmV0KTtcbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBrZXlWYXVsdENsaWVudC5zZXRTZWNyZXQodXJpLCBzZWNyZXROYW1lLCBzZWNyZXRWYWx1ZSk7XG4gICAgY29uc3Qgc2VjcmV0SWQgPSBLZXlWYXVsdC5wYXJzZVNlY3JldElkZW50aWZpZXIocmVzdWx0LmlkKTtcbiAgICByZXR1cm4gc2VjcmV0SWQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgdGhyb3cgbmV3IFZFcnJvcihcbiAgICAgIHsgbmFtZTogXCJLZXlWYXVsdEVycm9yXCIsIGNhdXNlOiBlcnJvciB9LFxuICAgICAgXCJGYWlsZWQgdG8gc2V0IHNlY3JldFwiXG4gICAgKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBzZXRTZWNyZXQ7XG4iLCJpbXBvcnQgeyB2NCBhcyB1dWlkIH0gZnJvbSBcInV1aWRcIjtcbmltcG9ydCB7IGNyZWF0ZUtleSwgZW5jcnlwdCwgc2V0U2VjcmV0IH0gZnJvbSBcImNwektleVZhdWx0XCI7XG5pbXBvcnQgZG90ZW52IGZyb20gXCJkb3RlbnYtc2FmZVwiO1xuXG5kb3RlbnYuY29uZmlnKCk7XG5jb25zdCB7XG4gIEtFWV9WQVVMVF9VUkwsXG4gIEtFWV9WQVVMVF9XUklURV9DTElFTlRfSUQsXG4gIEtFWV9WQVVMVF9XUklURV9BUFBfU0VDUkVUXG59ID0gcHJvY2Vzcy5lbnY7XG5hc3luYyBmdW5jdGlvbiBlbmNyeXB0QW5kU2F2ZShrZXlOYW1lLCBzZWNyZXROYW1lLCB2YWx1ZSkge1xuICBhd2FpdCBjcmVhdGVLZXkoe1xuICAgIHVyaTogS0VZX1ZBVUxUX1VSTCxcbiAgICBjbGllbnRJZDogS0VZX1ZBVUxUX1dSSVRFX0NMSUVOVF9JRCxcbiAgICBhcHBTZWNyZXQ6IEtFWV9WQVVMVF9XUklURV9BUFBfU0VDUkVULFxuICAgIGtleU5hbWVcbiAgfSk7XG4gIGNvbnN0IGVuY3J5cHRlZERhdGEgPSBhd2FpdCBlbmNyeXB0KHtcbiAgICB1cmk6IEtFWV9WQVVMVF9VUkwsXG4gICAgY2xpZW50SWQ6IEtFWV9WQVVMVF9XUklURV9DTElFTlRfSUQsXG4gICAgYXBwU2VjcmV0OiBLRVlfVkFVTFRfV1JJVEVfQVBQX1NFQ1JFVCxcbiAgICB2YWx1ZSxcbiAgICBrZXlOYW1lXG4gIH0pO1xuICBjb25zdCBzZWNyZXQgPSBhd2FpdCBzZXRTZWNyZXQoe1xuICAgIHVyaTogS0VZX1ZBVUxUX1VSTCxcbiAgICBjbGllbnRJZDogS0VZX1ZBVUxUX1dSSVRFX0NMSUVOVF9JRCxcbiAgICBhcHBTZWNyZXQ6IEtFWV9WQVVMVF9XUklURV9BUFBfU0VDUkVULFxuICAgIHNlY3JldFZhbHVlOiBlbmNyeXB0ZWREYXRhLFxuICAgIHNlY3JldE5hbWVcbiAgfSk7XG4gIHJldHVybiBzZWNyZXQudmVyc2lvbjtcbn1cbmFzeW5jIGZ1bmN0aW9uIHNhdmVBUElLZXlzKGFyZ3MpIHtcbiAgdGhpcy5sb2coYXJncyk7XG4gIGNvbnN0IHsgQVBJS2V5LCBBUElTZWNyZXQgfSA9IGFyZ3M7XG4gIGNvbnN0IHtcbiAgICB1c2VyLFxuICAgIHNwYXJlLFxuICAgIEFQSUtleUVuY3JLZXlOYW1lLFxuICAgIEFQSVNlY3JldEVuY3JLZXlOYW1lLFxuICAgIEFQSUtleVNlY3JldE5hbWUsXG4gICAgQVBJU2VjcmV0U2VjcmV0TmFtZVxuICB9ID0gYXJncy5vcHRpb25zO1xuXG4gIGNvbnN0IGluZm8gPSB7XG4gICAgQVBJS2V5OiB7fSxcbiAgICBBUElTZWNyZXQ6IHt9XG4gIH07XG4gIGlmICh1c2VyKSB7XG4gICAgaW5mby5BUElLZXkuZW5jcnlwdGlvbktleU5hbWUgPSB1c2VyLnRvU3RyaW5nKCk7XG4gICAgaW5mby5BUElTZWNyZXQuZW5jcnlwdGlvbktleU5hbWUgPSB1c2VyLnRvU3RyaW5nKCk7XG4gICAgaW5mby5BUElLZXkubmFtZSA9IHVzZXIudG9TdHJpbmcoKTtcbiAgICBpbmZvLkFQSVNlY3JldC5uYW1lID0gdXNlci50b1N0cmluZygpO1xuICB9XG4gIGluZm8uQVBJS2V5LmVuY3J5cHRpb25LZXlOYW1lID1cbiAgICBBUElLZXlFbmNyS2V5TmFtZSB8fCBpbmZvLkFQSUtleS5lbmNyeXB0aW9uS2V5TmFtZSB8fCB1dWlkKCk7XG4gIGluZm8uQVBJU2VjcmV0LmVuY3J5cHRpb25LZXlOYW1lID1cbiAgICBBUElTZWNyZXRFbmNyS2V5TmFtZSB8fCBpbmZvLkFQSVNlY3JldC5lbmNyeXB0aW9uS2V5TmFtZSB8fCB1dWlkKCk7XG4gIGluZm8uQVBJS2V5Lm5hbWUgPSBBUElLZXlTZWNyZXROYW1lIHx8IGluZm8uQVBJS2V5Lm5hbWUgfHwgdXVpZCgpO1xuICBpbmZvLkFQSVNlY3JldC5uYW1lID0gQVBJU2VjcmV0U2VjcmV0TmFtZSB8fCBpbmZvLkFQSVNlY3JldC5uYW1lIHx8IHV1aWQoKTtcbiAgaW5mby5BUElLZXkudmVyc2lvbiA9IGF3YWl0IGVuY3J5cHRBbmRTYXZlKFxuICAgIGluZm8uQVBJS2V5LmVuY3J5cHRpb25LZXlOYW1lLFxuICAgIGluZm8uQVBJS2V5Lm5hbWUsXG4gICAgQVBJS2V5XG4gICk7XG4gIGluZm8uQVBJU2VjcmV0LnZlcnNpb24gPSBhd2FpdCBlbmNyeXB0QW5kU2F2ZShcbiAgICBpbmZvLkFQSVNlY3JldC5lbmNyeXB0aW9uS2V5TmFtZSxcbiAgICBpbmZvLkFQSVNlY3JldC5uYW1lLFxuICAgIEFQSVNlY3JldFxuICApO1xuXG4gIGNvbnN0IGtleXMgPSB7fTtcbiAgaWYgKHNwYXJlKSB7XG4gICAga2V5cy5zcGFyZSA9IGluZm87XG4gIH0gZWxzZSB7XG4gICAga2V5cy5tYWluID0gaW5mbztcbiAgfVxuXG4gIHRoaXMubG9nKEpTT04uc3RyaW5naWZ5KGtleXMpKTtcbn1cblxuZXhwb3J0IHsgc2F2ZUFQSUtleXMgfTtcbiIsImltcG9ydCBcImJhYmVsLXBvbHlmaWxsXCI7XG5pbXBvcnQgVm9ycGFsIGZyb20gXCJ2b3JwYWxcIjtcblxuaW1wb3J0IHsgc2F2ZUFQSUtleXMgfSBmcm9tIFwiLi9rZXlWYXVsdFwiO1xuXG5jb25zdCB2b3JwYWwgPSBuZXcgVm9ycGFsKCk7XG52b3JwYWxcbiAgLmNvbW1hbmQoXG4gICAgXCJrdiBzYXZlIGFwaS1rZXlzIDxBUElLZXk+IDxBUElTZWNyZXQ+XCIsXG4gICAgXCJFbmNyeXB0IGFuZCBzYXZlIEV4Y2hhbmdlIEFQSSBLZXlzIHRvIEtleSBWYXVsdC5cIlxuICApXG4gIC5vcHRpb24oXCItdSwgLS11c2VyIDx1c2VySWQ+XCIsIFwiVXNlIHVzZXJJZCBhcyBuYW1lXCIpXG4gIC5vcHRpb24oXCItcywgLS1zcGFyZVwiLCBcIlNhdmUgc3BhcmUga2V5cy5cIilcbiAgLm9wdGlvbihcbiAgICBcIi0tQVBJS2V5RW5jcktleU5hbWUgPEFQSUtleUVuY3JLZXlOYW1lPlwiLFxuICAgIFwiRW5jcnlwdGlvbiBrZXkgbmFtZSBmb3IgQVBJIEtleS5cIlxuICApXG4gIC5vcHRpb24oXG4gICAgXCItLUFQSVNlY3JldEVuY3JLZXlOYW1lIDxBUElTZWNyZXRFbmNyS2V5TmFtZT5cIixcbiAgICBcIkVuY3J5cHRpb24ga2V5IG5hbWUgZm9yIEFQSSBTZWNyZXQuXCJcbiAgKVxuICAub3B0aW9uKFxuICAgIFwiLS1BUElLZXlTZWNyZXROYW1lIDxBUElLZXlTZWNyZXROYW1lPlwiLFxuICAgIFwiTmFtZSBvZiBzZWNyZXQgZm9yIEFQSSBLZXkuXCJcbiAgKVxuICAub3B0aW9uKFxuICAgIFwiLS1BUElTZWNyZXRTZWNyZXROYW1lIDxBUElTZWNyZXRTZWNyZXROYW1lPlwiLFxuICAgIFwiTmFtZSBvZiBzZWNyZXQgZm9yIEFQSSBTZWNyZXQuXCJcbiAgKVxuICAuYWN0aW9uKHNhdmVBUElLZXlzKTtcblxudm9ycGFsLmRlbGltaXRlcihcImNweiRcIikuc2hvdygpO1xuIiwibW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKFwiQGJhYmVsL3J1bnRpbWUvaGVscGVycy9hc3luY1RvR2VuZXJhdG9yXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcIkBiYWJlbC9ydW50aW1lL3JlZ2VuZXJhdG9yXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcImFkYWwtbm9kZVwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJhenVyZS1rZXl2YXVsdFwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJiYWJlbC1wb2x5ZmlsbFwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJkb3RlbnYtc2FmZVwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJ1dWlkXCIpOyIsIm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZShcInZlcnJvclwiKTsiLCJtb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoXCJ2b3JwYWxcIik7Il0sInNvdXJjZVJvb3QiOiIifQ==